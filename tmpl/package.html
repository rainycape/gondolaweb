{{/*
  extends: header.html
*/}}

{{ define "heading" }}
  {{ $lower := to_lower . }}
  <h2 id="pkg-{{ $lower }}">{{ . }}
    <a class="doc-anchor slide-up" href="#">{{ fa "caret-up" }}</a>
    <a class="doc-anchor" href="#pkg-{{ $lower }}">{{ fa "link" }}</a>
  </h2>
{{ end }}

{{ define "values" }}
  {{ $p := .Package }}
  {{ range .Values }}
    <pre class="doc">{{ $p.HTMLDecl .Decl }}</pre>
    {{ $p.ScopedHTML .Doc .Decl }}</p>
  {{ end }}
{{ end }}

{{ define "funcs" }}
  {{ $p := .Package }}
  {{ range .Funcs }}
    {{ $id := func_id . }}
    <h4 id="{{ $id }}">func {{ with .Recv }}({{ . }}) {{ end }}{{ .Name }}
      <a class="doc-anchor" href="#{{ $id }}">{{ fa "link" }}</a>
      <a class="doc-anchor" href="{{ $p.ReversePos .Decl }}">{{ fa "external-link" }}</a>
    </h4>
    <pre class="doc">{{ $p.HTMLDecl .Decl }}</pre>
    {{ $p.ScopedHTML .Doc .Decl }}</p>
  {{ end }}
{{ end }}


{{ define "content" }}
{{ with .Package }}
  {{ $package := . }}
  <div class="container">
    {{ if .ImportPath }}
      <p>
        <span class="import">import "{{ .ImportPath }}"</span>
        {{ $stats := .Stats }}
        {{ with $stats }}
          {{ $s := .Score }}
          <a href="javascript:void(0);" data-toggle="tooltip" title="Package Score" class="label label-{{ if lt $s 25.0 }}danger{{ else if lt $s 50.0 }}warning{{ else if lt $s 75.0 }}info{{ else }}success{{ end }}">{{ printf "%.2f" $s }}%</a>
          {{ with .Problems }}
            <a rel="popover" href="#pkg-issues" class="label label-danger">{{ with len . }}{{ . }} {{ $Ctx.Tn "issue" "issues" . }}{{ end }}</a>
          {{ end }}
          {{ if lt $s 100.0 }}
            <a class="show-undocumented" href="#pkg-improvements" rel="popover">Improve this!</a>
          {{ end }}
        {{ end }}
      </p>
      {{ with $stats }}
        <div id="pkg-improvements" class="doc-popover" data-title="Improve {{ $package.ImportPath }} score">
          <table class="table table-striped">
            <tbody>
              {{ if not .HasDoc }}
                <tr><td>Write this package's <a href="http://blog.golang.org/godoc-documenting-go-code">documentation</a></td><td><span class="label label-success">+{{ .NoDocPenalty }}%</span></td></tr>
              {{ end }}
	      {{ range .Undocumented }} 
                <tr><td><a href="#{{ .Id }}">{{ . }}</a></td><td><span class="label label-success">+{{ printf "%.2f" ($stats.Increase .Kind) }}%</span></td></tr>
              {{ end }}
            </tbody>
          </table>
        </div>
        {{ with .Problems }}
          <div id="pkg-issues" class="doc-popover" data-title="Issues detected">
            <table class="table table-striped">
              <tbody>
                {{ range . }}
                  <tr><td><a href="{{ $package.ReversePosition .Position }}">{{ with .Position }}{{ .Filename }}:{{ .Line }}{{ end }}</a></td><td>{{ .Text }}</td></tr>
                {{ end }}
              </tbody>
            </table>
          </div>
        {{ end }}
      {{ end }}
    {{ end }}
    {{ $doc := .Doc }}
    {{ with .Synopsis }}
      <h2>Overview</h2>
      <div class="synopsis">
        {{ . }}
      </div>
    {{ end }}
    {{ if .ImportPath }}<h2>Index</h2>{{ end }}
    <ul class="list-unstyled">
      {{ if .HasDoc }}
        <li><a href="#pkg-documentation">Documentation</a></li>
      {{ end }}
      {{ with $doc }}
        {{ with .Consts }}
          <li><a href="#pkg-constants">Constants</a></li>
        {{ end }}
        {{ with .Vars }}
          <li><a href="#pkg-variables">Variables</a></li>
        {{ end }}
      {{ end }}
    </ul>
    {{ with $doc }}
      {{ with .Types }}
        <h3>Types</h3>
        <ul class="list-unstyled">
          {{ range . }}
            <li><a href="#{{ type_id . }}">{{ .Name }}</a></li>
          {{ end }}
        </ul>
      {{ end }}
      {{ with .Funcs }}
        <h3>Functions</h3>
        <ul class="list-unstyled">
          {{ range . }}
            <li><a href="#{{ func_id . }}">{{ .Name }}</a></li>
          {{ end }}
        </ul>
      {{ end }}
    {{ end }}
    {{ with .Packages }}
      <h3>Subpackages</h3>
      <table class="table table-striped">
        <tbody>
          {{ range . }}
            {{ $p := .ImportPath }}
            <tr><td><a href="{{ reverse "doc" $p }}">{{ $p }}</a></td><td>{{ .Synopsis }}</td></tr>
          {{ end }}
      </table>
    {{ end }}
    {{ if .Filenames }}
      <h3>Files</h3>
        <ul class="list-inline list-unstyled">
          {{ $p := .ImportPath }}
          {{ range .Filenames }}
            <li><a href="{{ reverse "source" (concat $p "/" .) }}">{{ . }}</a></li>
          {{ end }}
        </ul>
    {{ end }}
    {{ if .HasDoc }}
      {{ template "heading" "Documentation" }}
      <div>
        {{ .HTMLDoc }}
      </div>
    {{ end }}
    {{ with $doc }}
      {{ with .Consts }}
        {{ template "heading" "Constants" }}
        <div>
          {{ template "values" map "Package" $package "Values" . }}
        </div>
      {{ end }}
      {{ with .Vars }}
        {{ template "heading" "Variables" }}
        <div>
          {{ template "values" map "Package" $package "Values" . }}
        </div>
      {{ end }}
      {{ with .Types }}
        {{ template "heading" "Types" }}
        <div>
          {{ range . }}
            {{ $id := type_id . }}
            <h3 id="{{ $id }}">type {{ .Name }}
              <a class="doc-anchor" href="#{{ $id }}">{{ fa "link" }}</a>
              <a class="doc-anchor" href="{{ $package.ReversePos .Decl }}">{{ fa "external-link" }}</a>
            </h3>
            <pre class="doc">{{ $package.HTMLDecl .Decl }}</pre>
            {{ $package.ScopedHTML .Doc .Decl }}
            {{ template "values" map "Package" $package "Values" .Consts }}
            {{ template "values" map "Package" $package "Values" .Vars }}
            {{ template "funcs" map "Package" $package "Funcs" .Funcs }}
            {{ template "funcs" map "Package" $package "Funcs" .Methods }}
          {{ end }}
        </div>
      {{ end }}
      {{ with .Funcs }}
        {{ template "heading" "Functions" }}
        <div>
          {{ range . }}
            {{ $id := func_id . }}
            <h3 id="{{ $id }}">func {{ .Name }}
              <a class="doc-anchor" href="#{{ $id }}">{{ fa "link" }}</a>
              <a class="doc-anchor" href="{{ $package.ReversePos .Decl }}">{{ fa "external-link" }}</a>
            </h3>
            <pre class="doc">{{ $package.HTMLDecl .Decl }}</pre>
            {{ $package.ScopedHTML .Doc .Decl }}
          {{ end }}
        </div>
      {{ end }}
    {{ end }}
  </div>
{{ end }}
{{ end }}
